<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://peachfuzzer.com/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://peachfuzzer.com/2012/Peach/peach/peach.xsd">
  <Defaults>
    <Number   signed="false" />
</Defaults>

<DataModel name="Protocol-version">
	<Number size="8" name="Tag" valueType="hex" value="80" token="true" mutable="false" />
	<Number size="8">
		<Relation type="size" lengthType="bytes" of="Data" />
	</Number>
     <Block name="Data">
 	<Number name="Padding" valueType="hex" value="07"  size="8" />
	<Number name="Value" valueType="hex" value="80"  size="8" />
         </Block>
 </DataModel>

<!-- carries the COSEM_Application_Context_Name the client proposes for the association -->
 <DataModel name="Application-context-name">
	<Number size="8" name="Tag" valueType="hex" value="A1" token="true" mutable="false"/>
	<Number size="8">
		<Relation type="size" lengthType="bytes" of="OID" />
	</Number>
      <Block name="OID">
         <Transformer class="DerEncodeOid"/>
             <Blob name="Data" value="2.16.756.5.8.1.1"/>
         </Block>
 </DataModel>
 
<!--calling-AE-qualifier: This field can be used to transport the public key certificate of the digital signature key of the client -->
<DataModel name="AE-qualifier">
	<Number size="8" name="Tag" valueType="hex" value="A3" token="true" mutable="false"/>
	<Number size="8">
		<Relation type="size" lengthType="bytes" of="Data" />
	</Number>
      <Block name="Data">
         <Transformer class="DerEncodeOctetString"/>
             <Blob value="80"/>
         </Block>
 </DataModel>

 <DataModel name="AP-invocation-identifier">
	<Number size="8" name="Tag" valueType="hex" value="A8" token="true" mutable="false"/>
      <Block>
         <Transformer class="DerEncodeInteger"/>
             <Number name="Data" size="32"/>
         </Block>
 </DataModel>

<DataModel name="AE-invocation-identifier" ref="AP-invocation-identifier">
	<Number name="Tag" valueType="hex" value="A9"  size="8" token="true" mutable="false"/>
</DataModel>

 
 <DataModel name="Mechanism-name">
	<Number name="Tag" valueType="hex" value="8B"  size="8" token="true" mutable="false"/>
	<Number size="8">
		<Relation type="size" lengthType="bytes" of="OID" />
	</Number>
    <Blob name="OID" valueType="hex" value="60 85 74 05 08 02 01"/>
 </DataModel>


<DataModel name="Authentication-value">
	<Number name="Tag" valueType="hex" value="AC"   size="8" token="true" mutable="false" />
	<Number size="8">
		<Relation type="size" lengthType="bytes" of="Info" />
	</Number>
    <Block name="Info">
	<Choice>
	<Block>
	<Number valueType="hex" value="80"  size="8" token="true" mutable="false" />
   </Block>
 	<Block>
 	<Number valueType="hex" value="81"  size="8" token="true" mutable="false" />
  </Block>
 	</Choice>
	<Number size="8">
		<Relation type="size" lengthType="bytes" of="Data" />
	</Number>
            <Blob name="Data" valueType="hex" value="31 32 33 34 35 36 37 38"/>
    </Block>
 </DataModel>
 

<DataModel name="Association-information">
	<Number name="Tag" valueType="hex" value="BE"  size="8" token="true" mutable="false" />
	<Number size="8">
		<Relation type="size" lengthType="bytes"  of="Info" />
	</Number>
    <Block name="Info">
		<Transformer class="DerEncodeOctetString"/>
            <Blob name="Data" valueType="hex" value="08 00 06 5F 1F 04 00 00 50 1F 01 F4 00 07"/>
    </Block>
 </DataModel>
 
 
 <DataModel name="ACSE-APDU">
	<Number name="Tag" valueType="hex" value="60"  size="8" token="true" mutable="false"/>
	<Number size="8">
		<Relation type="size" lengthType="bytes" of="payload" />
	</Number>
	<Block name="payload">	
	
<Block name="protocol-version" minOccurs="0"  ref="Protocol-version"/>
<Block name="application-context-name" ref="Application-context-name"/>
<Block name="called-AP-title" minOccurs="0" ref="AP-title"/>
<Block name="called-AE-qualifier" minOccurs="0" ref="AE-qualifier"/>
<Block name="called-AP-invocation-id" minOccurs="0" ref="AP-invocation-identifier"/>
<Block name="called-AE-invocation-id" minOccurs="0" ref="AE-invocation-identifier"/>
<Block name="calling-AP-title" minOccurs="0" ref="AP-title"/>
<Block name="calling-AE-qualifier" minOccurs="0" ref="AE-qualifier"/>
<Block name="calling-AP-invocation-id" minOccurs="0" ref="AP-invocation-identifier"/>
<Block name="calling-AE-invocation-id" minOccurs="0" ref="AE-invocation-identifier"/>
<Block name="sender-acse-requirements" minOccurs="0" ref="ACSE-requirements"/>
<Block name="mechanism-name" minOccurs="0" ref="Mechanism-name"/>
<Block name="calling-authentication-value" minOccurs="0" ref="Authentication-value"/>
<Block name="implementation-information" minOccurs="0" ref="Implementation-data"/>
<Block name="user-information" minOccurs="0" ref="Association-information"/>
  </Block>
</DataModel>
  
  
 <DataModel name="ARE-APDU">
  	<Number name="Tag" valueType="hex" value="61" size="8" />
<Block name="payload">	
<Block name="protocol-version" minOccurs="0"/>
<Block name="application-context-name" ref="Application-context-name"/>
<Block name="result" ref="Association-result"/>
<Block name="result-source-diagnostic" ref="Associate-source-diagnostic"/>
<Block name="responding-AP-title" minOccurs="0" ref="AP-title"/>
<Block name="responding-AE-qualifier" minOccurs="0" ref="AE-qualifier"/>
<Block name="responding-AP-invocation-id" minOccurs="0" ref="AP-invocation-identifier"/>
<Block name="responding-AE-invocation-id" minOccurs="0" ref="AE-invocation-identifier"/>
<Block name="responder-acse-requirements" minOccurs="0" ref="ACSE-requirements"/>
<Block name="mechanism-name" minOccurs="0" ref="Mechanism-name"/>
<Block name="responding-authentication-value" minOccurs="0" ref="Authentication-value"/>
<Block name="implementation-information" minOccurs="0" ref="Implementation-data"/>
<Block name="user-information" minOccurs="0" ref="Association-information"/>
  </Block>
  <Block name="rlrq">
<Block name="reason" minOccurs="0" ref="Release-request-reason"/>
<Block name="user-information" minOccurs="0" ref="Association-information"/>
  </Block>
    <Block name="rlre">
<Block name="reason" minOccurs="0" ref="Release-response-reason"/>
<Block name="user-information" minOccurs="0" ref="Association-information"/>
  </Block>
</DataModel>


  
  
  
  <StateModel name="TheState" initialState="Initial">
    <State name="Second">
      <Action type="output" publisher="bat">
        <DataModel ref="TheDataModel"/>
      </Action>
      <Action type="call" method="LaunchViewer" publisher="Peach.Agent"/>
    </State>
     </StateModel>
  <!-- The Agent executes the windows batch file 'pivottest.bat' which orchestrates the Japp client tool and concatenates/appends the logs of the results of each iteration in a single log file -->
  <Agent name="WinAgent">
    <Monitor class="WindowsDebugger">
      <Param name="CommandLine" value="C:\pivottest.bat" />
      <Param name="StartOnCall" value="LaunchViewer"/>
      <Param name="NoCpuKill" value="true" />
      <Param name="WaitForExitOnCall" value="true"/>
      <Param name="WaitForExitTimeout" value="-1"/>
      <Param name="WinDbgPath" value="C:\Users\achidamb\OneDrive - Itron\internship_tools\Debugging Tools for Windows (x64) v6.12\Debugging Tools for Windows (x64)" />
    </Monitor>
  </Agent>
	<Test name="Default">
		<StateModel ref="StateModel"/>
		<Publisher class="File">
			<Param name="FileName" value="fuzzfile.bin"/>
		</Publisher>
		<Logger class="Filesystem">
			<Param name="Path" value="logs"/>
		</Logger>   
	</Test>
</Peach>
<!-- end -->
